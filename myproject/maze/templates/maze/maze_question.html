{% extends "base.html" %}
{% block title %}ë¯¸ê¶ ë¬¸ì œ{% endblock %}

{% block content %}
<div class="card">
    <h2>ë¬¸ì œ {{ question.order }} ({{ question.get_level_display }})</h2>
    <p>{{ question.question_text }}</p>

    <!-- ì ìˆ˜ í‘œì‹œ -->
    <p><strong>í˜„ì¬ ì ìˆ˜:</strong> <span id="current-score">{{ request.session.score|default:0 }}</span>ì </p>

    <!-- ì œí•œ ì‹œê°„ í‘œì‹œ -->
    <p><strong>ì œí•œ ì‹œê°„:</strong> <span id="timer">{{ question.time_limit }}</span>ì´ˆ</p>

    <form id="answer-form">
        {% csrf_token %}
        <input type="text" name="answer" placeholder="ì •ë‹µ ì…ë ¥">
        <button type="submit" class="btn-primary">ì œì¶œ</button>
    </form>

    <button id="hint-btn" class="btn-secondary">ğŸ” íŒíŠ¸ ë³´ê¸°</button>
    <p id="hint-text"></p>
    
    <p id="feedback"></p>
</div>

<script>
    let timeRemaining = {{ question.time_limit }};
    const timerElement = document.getElementById("timer");
    const scoreElement = document.getElementById("current-score");
    const hintBtn = document.getElementById("hint-btn");
    const hintText = document.getElementById("hint-text");

    function updateTimer() {
        if (timeRemaining > 0) {
            timeRemaining--;
            timerElement.textContent = timeRemaining;
        } else {
            document.getElementById("feedback").innerHTML = "â³ ì œí•œ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤!";
            document.getElementById("answer-form").style.display = "none";
        }
    }

    setInterval(updateTimer, 1000);

    document.getElementById("answer-form").addEventListener("submit", function(event) {
        event.preventDefault();
        const formData = new FormData(this);

        fetch("{% url 'submit_answer' %}", {
            method: "POST",
            body: formData,
            headers: {"X-CSRFToken": "{{ csrf_token }}"}
        })
        .then(response => response.json())
        .then(data => {
            console.log("ì„œë²„ ì‘ë‹µ:", data) // ì„œë²„ ì‘ë‹µ ë¡œê·¸
            if (data.correct) {
                document.getElementById("feedback").innerHTML = "âœ… ì •ë‹µì…ë‹ˆë‹¤! ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™í•©ë‹ˆë‹¤.";

                if (data.next_question_url) {
                    console.log("âœ… ë‹¤ìŒ ë¬¸ì œ URL:", data.next_question_url); // âœ… ì´ë™ URL í™•ì¸
                    setTimeout(() => {
                        window.location.href = data.next_question_url;
                    }, 1000);  
                } else {
                    console.log("âŒ next_question_url ì—†ìŒ!");
                }
            } else {
                document.getElementById("feedback").innerHTML = data.message;
                document.getElementById("current-score").textContent = data.score;
            }
        })
        .catch(error => console.error("ì˜¤ë¥˜ ë°œìƒ:", error));
    });

    document.getElementById("hint-btn").addEventListener("click", function() {
        fetch("{% url 'get_hint' %}")
        .then(response => response.json())
        .then(data => {
            document.getElementById("hint-text").innerHTML = "ğŸ’¡ íŒíŠ¸: " + data.hint;
        });
    });
</script>
{% endblock %}