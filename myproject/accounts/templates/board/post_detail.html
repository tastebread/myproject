{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
    <h2>{{ post.title }}</h2>
    <p>ì‘ì„±ì: {{ post.author }}</p>
    <p>ì‘ì„±ì¼: {{ post.created_at }}</p>
    <hr>
    {% if post.image%}
        <img src="{{ post.image.url }}" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" style="max-width: 100%; border-radius: 10px;">
    {% endif %}
    <p>{{ post.content }}</p>

    <!-- ì¢‹ì•„ìš” ë²„íŠ¼ ì¶”ì¹´-->
     <div>
        <button id="like-btn" data-post-id="{{ post.id}}">
            {% if user in post.likes.all %}
                â¤ï¸ ì¢‹ì•„ìš” ì·¨ì†Œ
            {% else %}
                ğŸ¤ ì¢‹ì•„ìš”
            {% endif %}
        </button>
        <span id="like-count">{{ post.likes.count }}</span>
    </div>

    {% if user == post.author %}
        <div class="post-actions">
            <a href="{% url 'post_edit' post.id %}" class="edit-btn">ìˆ˜ì •</a>
            <a href="{% url 'post_delete' post.id %}" class="delete-btn">ì‚­ì œ</a>
        </div>
    {% endif %}
    
    <h3>ëŒ“ê¸€</h3>
    {% for comment in post.comments.all %}
        <div class="comment-box">
            <strong>{{ comment.author }}</strong>: {{ comment.content }}
            <div class="comment-actions">
                <small>{{ comment.created_at }}</small>
                {% if user == comment.author %}
                     <a href="{% url 'comment_edit' comment.id %}" class="edit-btn">ìˆ˜ì •</a>
                     <a href="{% url 'comment_delete' comment.id %}" class="delete-btn">ì‚­ì œ</a>
                {% endif %}
            </div>
        </div>
    {% endfor %}
    
    {% if user.is_authenticated %}
        <div class="comment-form">
            <form method="post" action="{% url 'add_comment' post.id %}">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
            </form>
        </div>
    {% else %}
        <p><a href="{% url 'login' %}">ë¡œê·¸ì¸</a> í›„ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    {% endif %}

    <a href="{% url 'post_list' %}"><button>ëª©ë¡ìœ¼ë¡œ</button></a>

    <!-- ì¢‹ì•„ìš” ê¸°ëŠ¥ì„ ìœ„í•œ JavaScript -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const likeBtn = document.getElementById("like-btn");
            const likeCount = document.getElementById("like-count");
            
            likeBtn.addEventListener("click", function() {
                const postId = likeBtn.getAttribute("data-post-id");
                
                fetch(`/board/post/${postId}/like/`, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",
                        "Content-Type": "application/json"
                    },
                    credentials: "same-origin"
                })
                .then(response => response.json())
                .then(data => {
                    if (data.liked) {
                        likeBtn.innerHTML = "â¤ï¸ ì¢‹ì•„ìš” ì·¨ì†Œ";
                    } else {
                        likeBtn.innerHTML = "ğŸ¤ ì¢‹ì•„ìš”";
                    }
                    likeCount.textContent = data.total_likes;
                })
                .catch(error => console.error("Error:", error));
            });
        });
    </script>
{% endblock %}